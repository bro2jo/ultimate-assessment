<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assessment Successfully Submitted</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Add to your existing CSS */
.skill-analysis-wrapper {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-lg);
}

/* Add any missing Tailwind utility classes that might be needed */
.bg-gray-900 {
    background-color: #111827;
}

.border-gray-800 {
    border-color: #1f2937;
}

.text-gray-200 {
    color: #e5e5e5;
}

.text-gray-400 {
    color: #9ca3af;
}

.text-gray-300 {
    color: #d1d5db;
}

.bg-white\/5 {
    background-color: rgba(255, 255, 255, 0.05);
}

.bg-orange-500\/10 {
    background-color: rgba(249, 115, 22, 0.1);
}

.text-green-500 {
    color: #22c55e;
}

.text-yellow-500 {
    color: #eab308;
}

.text-red-500 {
    color: #ef4444;
}

.bg-gray-700 {
    background-color: #374151;
}

.bg-green-500 {
    background-color: #22c55e;
}

.bg-yellow-500 {
    background-color: #eab308;
}

.bg-red-500 {
    background-color: #ef4444;
}

.text-orange-500 {
    color: #f97316;
}

.bg-gray-800\/50 {
    background-color: rgba(31, 41, 55, 0.5);
}
        /* CSS Reset and Base Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* CSS Variables for consistent theming */
        :root {
            --primary-color: #ff9123;
            --secondary-color: #7a1fbf;
            --dark-bg: #1f1f1f;
            --darker-bg: #2d2d2d;
            --text-primary: #fff;
            --text-secondary: #e5e5e5;
            --text-muted: #999;
            --gradient: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --border-radius: 12px;
            --spacing-sm: 10px;
            --spacing-md: 20px;
            --spacing-lg: 30px;
        }

        /* Core Layout */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            background-color: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-md);
        }
        /* Canvas Element */
        #radarChart {
            width: 100% !important;
            height: auto !important;
        }
        /* Success Page Styles */
        .success-container {
            max-width: 800px;
            padding: 40px;
            background: var(--darker-bg);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .success-header {
            text-align: center;
            margin-bottom: var(--spacing-lg);
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--spacing-md);
        }

        .success-icon i {
            font-size: 40px;
            color: var(--text-primary);
        }

        /* Typography */
        h1 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 28px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 18px;
            margin-bottom: var(--spacing-lg);
        }

        /* Next Steps Section */
        .next-steps {
            background: rgba(255, 145, 35, 0.1);
            border-radius: var(--border-radius);
            padding: 25px;
            margin: var(--spacing-lg) 0;
        }

        .next-steps h2 {
            color: var(--primary-color);
            font-size: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        /* Steps List */
        .steps-list {
            list-style: none;
        }

        .steps-list li {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            color: var(--text-secondary);
        }

        .steps-list i {
            color: var(--primary-color);
            margin-top: 5px;
        }

        /* Assessment Results */
        .assessment-results {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
        }

        .results-group {
            margin-bottom: var(--spacing-md);
        }

        .results-group h3 {
            color: var(--primary-color);
            margin-bottom: var(--spacing-sm);
            font-size: 16px;
        }
        /* Sub-Category Styles */
        .results-group.sub-category {
            border-left: 4px solid var(--secondary-color);
            padding-left: 16px;
            margin-bottom: 20px;
        }
        .skill-result {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .skill-result .rating {
            font-weight: bold;
        }

        /* Meta Information */
        .assessment-meta {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: var(--spacing-sm);
            margin-bottom: 15px;
            font-size: 14px;
            color: var(--text-muted);
        }

        /* Action Buttons */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: var(--spacing-lg);
        }

        .button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            background: var(--gradient);
            color: var(--text-primary);
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.3s ease;
            text-align: center;
            cursor: pointer;
            border: none;
            font-size: 16px;
        }

        .button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 145, 35, 0.3);
        }

        .button.outline {
            background: transparent;
            border: 2px solid var(--primary-color);
        }

        /* Reminder Box */
        .reminder-box {
            background: rgba(122, 31, 191, 0.1);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-top: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .reminder-icon {
            font-size: 24px;
            color: var(--secondary-color);
        }

        .reminder-text {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Radar Chart */
        .chart-container {
            position: relative;
            width: 100%;
            height: 400px;
            margin-bottom: var(--spacing-lg);
        }

        /* Level Card Styles */
        .level-card {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: var(--spacing-lg);
            color: var(--text-primary);
            position: relative;
            overflow: hidden;
        }

        .level-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
            pointer-events: none;
        }

        .level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .level-info h2 {
            font-size: 32px;
            margin-bottom: 8px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        #levelTitle {
            font-size: 16px;
            opacity: 0.9;
        }

        .level-icon {
            font-size: 48px;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .level-icon:hover {
            transform: scale(1.1);
        }

        .progress-track {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            height: 8px;
            overflow: hidden;
            margin: 8px 0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 6px;
            transition: width 0.5s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }

        #progressPercent {
            text-align: right;
        }

        #progressPercent::after {
            content: ' / 100';
        }

        /* Achievement Cards */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: var(--spacing-lg);
        }

        .achievement-card {
            background: var(--darker-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.2s ease;
        }

        .achievement-card:hover {
            transform: translateY(-2px);
        }

        .achievement-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .achievement-locked {
            display: none;
            opacity: 0.5;
            filter: grayscale(1);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: var(--spacing-lg);
        }

        .stat-card {
            background: var(--darker-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary-color);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 14px;
        }

        /* Development Path */
        .development-path {
            background: var(--darker-bg);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: var(--spacing-lg);
        }

        .section-title {
            color: var(--primary-color);
            font-size: 20px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .path-step {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .step-content h4 {
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .step-content p {
            color: var(--text-muted);
            font-size: 14px;
        }

        /* Text utility classes */
        .text-muted {
            color: var(--text-muted);
            font-size: 14px;
        }

        /* Chart Tooltip Styles */
        #chartjs-tooltip {
            position: absolute;
            pointer-events: none;
            opacity: 0;
            transition: all .1s ease;
            background: rgba(45, 45, 45, 0.95);
            border-radius: 8px;
            color: #fff;
            padding: 10px;
            box-shadow: 0px 0px 10px rgba(0,0,0,0.5);
            transform: translate(-50%, 0);
            z-index: 1000;
            /* Allow tooltip to adjust height based on content */
            max-height: 300px;  /* Increase as needed */
            overflow: hidden;    /* Hide overflow, scroll handled in JS */
        }

        /* Optional: Smooth scroll within tooltip */
        #chartjs-tooltip .tooltip-body {
            overflow-y: auto;
        }
        .sub-category {
            margin-top: 30px;
        }

        .sub-category-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            position: relative;
        }

        /* Tooltip Styles */
        .sub-category-title .tooltip {
            visibility: hidden;
            width: 200px;
            background-color: var(--background-dark);
            color: var(--text-secondary);
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 10;
            bottom: 125%; /* Position above the title */
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .sub-category-title:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }

        /* Average Rating Display */
        .average-rating {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 10px;
            font-size: 14px;
            color: var(--text-muted);
        }

        .average-rating span {
            font-weight: 600;
            color: var(--primary-color);
            margin-left: 5px;
        }

        /* Optional: Highlight Sub-Categories on Hover */
        .sub-category-title:hover {
            color: var(--primary-color);
        }
        /* PDF Template Styles */
        .pdf-template {
            font-family: Arial, sans-serif;
            color: #333;
            padding: 20px;
        }

        .pdf-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .pdf-header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .pdf-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .pdf-meta-item {
            font-size: 14px;
        }

        .pdf-section {
            margin-bottom: 20px;
        }

        .pdf-section h2 {
            font-size: 18px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .pdf-average-rating {
            font-size: 14px;
            margin-bottom: 10px;
            color: var(--text-muted);
        }

        .pdf-skill-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .pdf-skill-name {
            font-size: 14px;
        }

        .pdf-rating-value {
            font-size: 14px;
            font-weight: bold;
            margin-right: 10px;
        }

        .pdf-rating-bar {
            width: 100px;
            height: 10px;
            background-color: #ddd;
            border-radius: 5px;
            overflow: hidden;
        }

        .pdf-rating-fill {
            height: 100%;
            background-color: var(--primary-color);
        }

        .pdf-summary {
            margin-top: 30px;
        }

        .pdf-summary h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .pdf-summary ul {
            list-style: disc;
            padding-left: 20px;
        }

        .pdf-summary li {
            margin-bottom: 5px;
        }

    </style>
</head>
<body>
    <main class="success-container">
        <!-- Header Section -->
        <header class="success-header">
            <div class="success-icon" aria-hidden="true">
                <i class="fas fa-check"></i>
            </div>
            <h1>Assessment Submitted Successfully!</h1>
            <p class="subtitle">Thank you for completing your Ultimate skills self-assessment.</p>
        </header>
        
        <!-- Next Steps Section -->
        <section class="next-steps">
            <h2><i class="fas fa-forward" aria-hidden="true"></i> Next Steps</h2>
            <ul class="steps-list">
                <li>
                    <i class="fas fa-bullseye" aria-hidden="true"></i>
                    <div>Review your results against your personal goals and team's strategic needs. Consider which skills most impact your role and playing style.</div>
                </li>
                <li>
                    <i class="fas fa-route" aria-hidden="true"></i>
                    <div>Make a focused decision: either master your strengths further (becoming exceptional in key areas) or develop specific weaker skills that align with your goals.</div>
                </li>
                <li>
                    <i class="fas fa-tasks" aria-hidden="true"></i>
                    <div>Create a specific training plan with measurable targets. Focus on quality practice in 2-3 key areas rather than trying to improve everything at once.</div>
                </li>
            </ul>
        </section>
        <aside class="reminder-box" role="note">
            <i class="fas fa-bell reminder-icon" aria-hidden="true"></i>
            <div class="reminder-text">
                <strong>Pro Tip:</strong> Take photos or videos of your practice sessions. They're great for tracking progress and getting feedback.
            </div>
        </aside>
    
        <!-- Assessment Results Section -->
        <section class="assessment-results">
            <div class="level-card">
                <div class="level-header">
                    <div class="level-info">
                        <h2>Current Rating: <span id="playerRating" aria-live="polite">0</span></h2>
                        <p id="levelTitle">Ultimate Skills Assessment</p>
                    </div>
                    <div class="level-icon" id="levelIcon" aria-hidden="true">
                        <i class="fas fa-star"></i>
                    </div>
                </div>
                <div class="progress-track" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                    <div class="progress-fill" id="levelProgress"></div>
                </div>
                <div class="progress-labels">
                    <span></span>  <!-- Empty span to maintain flex spacing -->
                    <span id="progressPercent" aria-live="polite">0</span>
                </div>
            </div>
    
            <div class="chart-container" role="img" aria-label="Skills radar chart">
                <canvas id="radarChart"></canvas>
            </div>
    
            <div class="achievements-grid" role="list">
                <!-- Achievement Cards -->
                <!-- Removed the Master Handler Achievement Card as it's based on old 'throwing' skill -->
                <div class="achievement-card achievement-locked" id="speedDemon" role="listitem">
                    <div class="achievement-icon" style="background: linear-gradient(135deg, #60a5fa, #2563eb);" aria-hidden="true">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div>
                        <h3>Speed Demon</h3>
                        <p class="text-muted">Outstanding cutting ability</p>
                    </div>
                </div>
                <div class="achievement-card achievement-locked" id="strategist" role="listitem">
                    <div class="achievement-icon" style="background: linear-gradient(135deg, #a855f7, #7c3aed);" aria-hidden="true">
                        <i class="fas fa-chess"></i>
                    </div>
                    <div>
                        <h3>Strategic Mind</h3>
                        <p class="text-muted">High game IQ</p>
                    </div>
                </div>
                <div class="achievement-card achievement-locked" id="movementMaster" role="listitem">
                    <div class="achievement-icon" style="background: linear-gradient(135deg, #22c55e, #059669);" aria-hidden="true">
                        <i class="fas fa-running"></i>
                    </div>
                    <div>
                        <h3>Movement Master</h3>
                        <p class="text-muted">Exceptional cutting skills</p>
                    </div>
                </div>
                <div class="achievement-card achievement-locked" id="defenseMaster" role="listitem">
                    <div class="achievement-icon" style="background: linear-gradient(135deg, #60a5fa, #2563eb);" aria-hidden="true">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div>
                        <h3>Defense Specialist</h3>
                        <p class="text-muted">Superior defensive skills</p>
                    </div>
                </div>
                <div class="achievement-card achievement-locked" id="athleticExcellence" role="listitem">
                    <div class="achievement-icon" style="background: linear-gradient(135deg, #f472b6, #db2777);" aria-hidden="true">
                        <i class="fas fa-dumbbell"></i>
                    </div>
                    <div>
                        <h3>Athletic Excellence</h3>
                        <p class="text-muted">Exceptional physical ability</p>
                    </div>
                </div>
                <div class="achievement-card achievement-locked" id="ultimate_master" role="listitem">
                    <div class="achievement-icon" style="background: linear-gradient(135deg, #f59e0b, #b45309);" aria-hidden="true">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div>
                        <h3>Ultimate Master</h3>
                        <p class="text-muted">Achieved perfect mastery</p>
                    </div>
                </div>
                <!-- Added Handling Excellence Achievement Card -->
                <div class="achievement-card achievement-locked" id="handlingExcellence" role="listitem">
                    <div class="achievement-icon" style="background: linear-gradient(135deg, #22c55e, #059669);" aria-hidden="true">
                        <i class="fas fa-handshake"></i>
                    </div>
                    <div>
                        <h3>Handling Excellence</h3>
                        <p class="text-muted">Exceptional handling skills</p>
                    </div>
                </div>
                <!-- Added Master Thrower Achievement Card -->
                <div class="achievement-card achievement-locked" id="masterThrower" role="listitem">
                    <div class="achievement-icon" style="background: linear-gradient(135deg, #ff9123, #7a1fbf);" aria-hidden="true">
                        <i class="fas fa-bullseye"></i>
                    </div>
                    <div>
                        <h3>Master Thrower</h3>
                        <p class="text-muted">Exceptional throwing skills</p>
                    </div>
                </div>
                <!-- (Optional) Add new achievement card here if needed -->
            </div>
    
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <i class="fas fa-trophy" aria-hidden="true"></i>
                        <span>Top Skill</span>
                    </div>
                    <div class="stat-value" id="topSkill" aria-live="polite">-</div>
                    <div class="stat-label" id="topSkillRating">0/10</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <i class="fas fa-bullseye" aria-hidden="true"></i>
                        <span>Focus Area</span>
                    </div>
                    <div class="stat-value" id="focusSkill" aria-live="polite">-</div>
                    <div class="stat-label" id="focusSkillRating">0/10</div>
                </div>
            </div>

            <div id="skillAnalysisRoot"></div>
        </section>
    
        <div class="action-buttons">
            <a href="/" class="button" role="button">
                <i class="fas fa-redo" aria-hidden="true"></i>
                Take Another Assessment
            </a>
            <button type="button" id="saveButton" class="button outline">
                <i class="fas fa-download" aria-hidden="true"></i>
                Save Results as PDF
            </button>
        </div>
    </main>
    
    <!-- PDF Template -->
    <div class="pdf-template" id="pdfTemplate" hidden>
        <div class="pdf-header">
            <h1>Ultimate Skills Assessment Report</h1>
            <div class="assessment-date" id="pdfDate"></div>
        </div>
    
        <div class="pdf-meta">
            <div class="pdf-meta-item">
                <strong>Player Name:</strong>
                <span id="pdfName"></span>
            </div>
            <div class="pdf-meta-item">
                <strong>Assessment Date:</strong>
                <span id="pdfAssessmentDate"></span>
            </div>
        </div>
    
        <div id="pdfSkillSections">
            <!-- Skill sections will be populated by JavaScript -->
        </div>
    
        <div class="pdf-summary">
            <h3>Assessment Summary</h3>
            <ul id="pdfSummaryPoints">
                <!-- Summary points will be populated by JavaScript -->
            </ul>
        </div>
    </div>

    <script>
        // Configuration Constants
        const SKILL_CATEGORIES = {
            'Cutting & Movement': [
                'isolation_cutting',
                'continuation_cutting',
                'angles',
                'fakes_footwork',
                'timing_field_vision',
                'decisiveness',
                'catching',
                'zone_offense',
                'reading_the_disc'
            ],
            'Handling': [ // Added new category
                'poise_with_disc',
                'breaking_the_mark',
                'resetting_from_trap_sideline',
                'decision_making_vision',
                'flow_awareness',
                'throw_and_go',
                'offensive_pattern_recognition'
            ],
            'Throwing Skills': { // Changed from array to object for subcategories
                'Backhand': [
                    'backhand_power',
                    'backhand_accuracy',
                    'backhand_quick_release',
                    'backhand_release_variations',
                    'backhand_against_wind',
                    'backhand_against_difficult_marks',
                    'backhand_tempo_control'
                ],
                'Forehand': [
                    'forehand_power',
                    'forehand_accuracy',
                    'forehand_quick_release',
                    'forehand_release_variations',
                    'forehand_against_wind',
                    'forehand_against_difficult_marks',
                    'forehand_tempo_control'
                ],
                'Specialty': [
                    'specialty_power',
                    'specialty_accuracy',
                    'specialty_quick_release',
                    'specialty_release_variations',
                    'specialty_against_wind',
                    'specialty_against_difficult_marks',
                    'specialty_tempo_control'
                ],
                'Hucks': [
                    'hucking_confidence',
                    'hucking_shape_control',
                    'hucking_tempo_control',
                    'hucking_placement'
                ]
            },
            'Defending': [ // Renamed from 'Defense' to 'Defending' and updated skills
                'normal_marking',
                'sideline_trap_marking',
                'downfield_defending',
                'handler_defending',
                'defensive_pattern_recognition',
                'help_defense',
                'switching_on_defense',
                'zone_defense',
                'defensive_mental_fortitude'
            ],
            'Fitness & Athleticism': [
                'speed_explosiveness',
                'endurance',
                'vertical_leap',
                'change_of_direction',
                'boxing_out',
                'laying_out',
                'recovery',
                'flexibility_mobility',
                'injury_prevention'
            ],
            'Strategy & Game IQ': ['defensive_strategy', 'offensive_strategy', 'mental_game', 'feedback_implementation']
        };

        const LEVEL_CONFIG = {
            0: { title: 'Beginner', description: 'Starting Your Ultimate Journey', icon: 'seedling' },
            20: { title: 'Developing', description: 'Building Fundamental Skills', icon: 'child' },
            40: { title: 'Intermediate', description: 'Refining Your Game', icon: 'running' },
            60: { title: 'Advanced', description: 'Mastering Complex Skills', icon: 'star' },
            80: { title: 'Elite', description: 'Exceptional Performance', icon: 'crown' },
            95: { title: 'Master', description: 'Ultimate Skills Master', icon: 'trophy' }
        };

        const ACHIEVEMENT_THRESHOLDS = {
            // Removed masterHandler as it's based on old 'throwing' skill
            speedDemon: { skills: [
                'isolation_cutting',
                'continuation_cutting',
                'angles',
                'fakes_footwork',
                'timing_field_vision',
                'decisiveness',
                'catching',
                'zone_offense',
                'reading_the_disc'
            ], threshold: 8 },
            strategist: { skill: 'mental_game', threshold: 8 },
            athleticExcellence: { category: 'Fitness & Athleticism', threshold: 8 },
            movementMaster: { skills: [
                'isolation_cutting',
                'continuation_cutting',
                'angles',
                'fakes_footwork',
                'timing_field_vision',
                'decisiveness',
                'catching',
                'zone_offense',
                'reading_the_disc'
            ], threshold: 9 },
            defenseMaster: { // Newly added achievement for Defending
                skills: [
                    'normal_marking',
                    'sideline_trap_marking',
                    'downfield_defending',
                    'handler_defending',
                    'defensive_pattern_recognition',
                    'help_defense',
                    'switching_on_defense',
                    'zone_defense',
                    'defensive_mental_fortitude'
                ],
                threshold: 8
            },
            handlingExcellence: { 
                skills: [
                    'poise_with_disc',
                    'breaking_the_mark',
                    'resetting_from_trap_sideline',
                    'decision_making_vision',
                    'flow_awareness',
                    'throw_and_go',
                    'offensive_pattern_recognition'
                ],
                threshold: 8
            },
            masterThrower: { // New achievement based on new Throwing Skills
                skills: [
                    'backhand_power',
                    'backhand_accuracy',
                    'backhand_quick_release',
                    'backhand_release_variations',
                    'backhand_against_wind',
                    'backhand_against_difficult_marks',
                    'backhand_tempo_control',
                    'forehand_power',
                    'forehand_accuracy',
                    'forehand_quick_release',
                    'forehand_release_variations',
                    'forehand_against_wind',
                    'forehand_against_difficult_marks',
                    'forehand_tempo_control',
                    'specialty_power',
                    'specialty_accuracy',
                    'specialty_quick_release',
                    'specialty_release_variations',
                    'specialty_against_wind',
                    'specialty_against_difficult_marks',
                    'specialty_tempo_control',
                    'hucking_confidence',
                    'hucking_shape_control',
                    'hucking_tempo_control',
                    'hucking_placement'
                ],
                threshold: 8
            },
            ultimate_master: { // Added missing 'ultimate_master' achievement
                skills: [
                    'poise_with_disc',
                    'breaking_the_mark',
                    'handler_movement',
                    'speed_explosiveness',
                    'backhand_power',
                    'forehand_power',
                    'mental_game',
                    'defensive_pattern_recognition',
                    'flow_awareness'
                ],
                threshold: 10
            }
            // (Optional) Add new achievement thresholds here if needed
            // e.g., feedbackImplementation: { skill: 'feedback_implementation', threshold: 8 }
        };

        class AppError extends Error {
            constructor(message, context) {
                super(message);
                this.context = context;
                this.name = 'AppError';
            }
        }

        const ErrorHandler = {
            handleError(error, context) {
                console.error(`Error in ${context}:`, error);
                this.showUserError(context);
                return null;
            },

            showUserError(context) {
                const errorMessages = {
                    'data-retrieval': 'Unable to retrieve assessment data. Please try again.',
                    'pdf-generation': 'Error generating PDF. Please try again.',
                    'chart-creation': 'Unable to create skill chart.',
                    'ui-update': 'Error updating display.',
                    'validation': 'Invalid data format.',
                    'default': 'An unexpected error occurred. Please try again.'
                };
                alert(errorMessages[context] || errorMessages.default);
            }
        };

        class Utils {
            static isValidSkill(skill) {
                return Object.values(SKILL_CATEGORIES).flat().includes(skill);
            }

            static sanitizeInput(input) {
                if (typeof input !== 'string') return '';
                const entities = { '<': '&lt;', '>': '&gt;', '&': '&amp;' };
                return input.replace(/[<>&]/g, char => entities[char] || char);
            }

            static formatSkillName(skill) {
                if (typeof skill !== 'string') return '';
                return skill
                    .replace(/_/g, ' ')
                    .split(' ')
                    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                    .join(' ');
            }

            static validateRating(rating) {
                const num = Number(rating);
                return !isNaN(num) && num >= 1 && num <= 10 ? num : 5;
            }

            static getUrlParams() {
                try {
                    return Object.fromEntries(new URLSearchParams(window.location.search).entries());
                } catch (error) {
                    ErrorHandler.handleError(error, 'url-params');
                    return {};
                }
            }

            static calculateAverage(values) {
                if (!values.length) return 0;
                return values.reduce((a, b) => a + b, 0) / values.length;
            }

            static sanitizeFileName(name) {
                return name.toLowerCase().replace(/[^a-z0-9]/g, '-');
            }
        }

        class DOMHelper {
            static getElement(id) {
                const element = document.getElementById(id);
                if (!element) {
                    throw new AppError(`Element with id '${id}' not found`, 'dom-access');
                }
                return element;
            }

            static setContent(id, content) {
                try {
                    this.getElement(id).textContent = content;
                } catch (error) {
                    ErrorHandler.handleError(error, 'dom-update');
                }
            }

            static setHTML(id, html) {
                try {
                    this.getElement(id).innerHTML = html;
                } catch (error) {
                    ErrorHandler.handleError(error, 'dom-update');
                }
            }

            static toggleClass(id, className, condition) {
                try {
                    const element = this.getElement(id);
                    element.classList.toggle(className, condition);
                } catch (error) {
                    ErrorHandler.handleError(error, 'dom-update');
                }
            }

            static setStyle(id, property, value) {
                try {
                    this.getElement(id).style[property] = value;
                } catch (error) {
                    ErrorHandler.handleError(error, 'dom-update');
                }
            }
        }

        class AssessmentDataManager {
            static getAssessmentData() {
                try {
                    const storedData = localStorage.getItem('skillAssessment');
                    if (storedData) {
                        return this.validateAssessmentData(JSON.parse(storedData));
                    }

                    const urlParams = Utils.getUrlParams();
                    if (Object.keys(urlParams).length === 0) return null;

                    const assessmentData = {
                        name: Utils.sanitizeInput(urlParams.name) || 'Anonymous',
                        email: Utils.sanitizeInput(urlParams.email) || '',
                        date: new Date().toLocaleDateString(),
                        ratings: {}
                    };

                    Object.entries(urlParams)
                        .filter(([key]) => Utils.isValidSkill(key))
                        .forEach(([key, value]) => {
                            assessmentData.ratings[key] = Utils.validateRating(value);
                        });

                    return assessmentData;
                } catch (error) {
                    return ErrorHandler.handleError(error, 'data-retrieval');
                }
            }

            static validateAssessmentData(data) {
                if (!data || typeof data !== 'object') {
                    throw new AppError('Invalid assessment data structure', 'validation');
                }

                const flattenedRatings = {};

                // Flatten ratings from nested categories if any
                Object.entries(SKILL_CATEGORIES).forEach(([category, skillsOrSubcategories]) => {
                    if (typeof skillsOrSubcategories === 'object' && !Array.isArray(skillsOrSubcategories)) {
                        // Handle subcategories
                        Object.values(skillsOrSubcategories).flat().forEach(skill => {
                            if (data.ratings[skill]) {
                                flattenedRatings[skill] = Utils.validateRating(data.ratings[skill]);
                            }
                        });
                    } else {
                        // Handle regular categories
                        skillsOrSubcategories.forEach(skill => {
                            if (data.ratings[skill]) {
                                flattenedRatings[skill] = Utils.validateRating(data.ratings[skill]);
                            }
                        });
                    }
                });

                return {
                    name: Utils.sanitizeInput(data.name) || 'Anonymous',
                    email: Utils.sanitizeInput(data.email) || '',
                    date: data.date || new Date().toLocaleDateString(),
                    ratings: flattenedRatings
                };
            }
        }

        class SkillsAnalyzer {
            static calculateSkillSummary(ratings) {
                const summary = {
                    strongestCategory: '',
                    strongestScore: 0,
                    weakestCategory: '',
                    weakestScore: 10,
                    topSkills: [],
                    improvementAreas: []
                };

                Object.entries(SKILL_CATEGORIES).forEach(([category, skillsOrSubcategories]) => {
                    let categoryAvg = 0;
                    let validSkills = [];

                    if (typeof skillsOrSubcategories === 'object' && !Array.isArray(skillsOrSubcategories)) {
                        // Handle subcategories
                        Object.entries(skillsOrSubcategories).forEach(([subCategory, skills]) => {
                            const subCategoryRatings = skills.map(skill => Number(ratings[skill])).filter(r => !isNaN(r));
                            const subCategoryAvg = Utils.calculateAverage(subCategoryRatings);
                            
                            if (subCategoryAvg > summary.strongestScore) {
                                summary.strongestScore = subCategoryAvg;
                                summary.strongestCategory = `${category} - ${subCategory}`;
                            }
                            if (subCategoryAvg < summary.weakestScore) {
                                summary.weakestScore = subCategoryAvg;
                                summary.weakestCategory = `${category} - ${subCategory}`;
                            }

                            // Collect top skills and improvement areas
                            skills.forEach(skill => {
                                const rating = Number(ratings[skill]);
                                if (rating >= 8) summary.topSkills.push({ name: skill, rating });
                                if (rating <= 4) summary.improvementAreas.push({ name: skill, rating });
                            });

                            // Aggregate for overall category average if needed
                            validSkills = validSkills.concat(subCategoryRatings);
                        });

                        categoryAvg = Utils.calculateAverage(validSkills);
                    } else {
                        // Handle regular categories
                        const skills = skillsOrSubcategories;
                        const skillRatings = skills.map(skill => Number(ratings[skill])).filter(r => !isNaN(r));
                        categoryAvg = Utils.calculateAverage(skillRatings);

                        if (categoryAvg > summary.strongestScore) {
                            summary.strongestScore = categoryAvg;
                            summary.strongestCategory = category;
                        }
                        if (categoryAvg < summary.weakestScore) {
                            summary.weakestScore = categoryAvg;
                            summary.weakestCategory = category;
                        }

                        // Collect top skills and improvement areas
                        skills.forEach(skill => {
                            const rating = Number(ratings[skill]);
                            if (rating >= 8) summary.topSkills.push({ name: skill, rating });
                            if (rating <= 4) summary.improvementAreas.push({ name: skill, rating });
                        });
                    }
                });

                return summary;
            }

            static calculateRating(ratings) {
                const values = Object.values(ratings);
                return Math.round(Utils.calculateAverage(values) * 10);
            }

            static calculateLevel(ratings) {
                const avgRating = Utils.calculateAverage(Object.values(ratings)) * 10;
                const levels = Object.keys(LEVEL_CONFIG).map(Number).sort((a, b) => a - b);
                
                const currentLevel = levels.reduce((acc, level) => 
                    avgRating >= level ? level : acc, 0);
                
                const nextLevel = levels.find(level => level > currentLevel) || 100;
                const progress = Math.min(100, Math.max(0, avgRating));
                
                return {
                    currentLevel,
                    nextLevel,
                    progress: Math.round(progress),
                    config: LEVEL_CONFIG[currentLevel]
                };
            }
        }

        class UIManager {
            static init() {
                try {
                    const data = AssessmentDataManager.getAssessmentData();
                    if (!data) return;

                    this.updateUI(data);
                    ChartManager.initializeRadarChart(data);
                } catch (error) {
                    ErrorHandler.handleError(error, 'initialization');
                }
            }

            static updateUI(data) {
                try {
                    this.updateAchievements(data.ratings);
                    this.updateStats(data.ratings);
                    this.updateLevel(data.ratings);
                    this.updateResults(data);
                    this.updateLevelTitle(data.name);
                } catch (error) {
                    ErrorHandler.handleError(error, 'ui-update');
                }
            }

            static updateAchievements(ratings) {
                Object.entries(ACHIEVEMENT_THRESHOLDS).forEach(([id, { skill, skills, category, threshold }]) => {
                    if (skill) {
                        // Achievement based on individual skill
                        DOMHelper.toggleClass(id, 'achievement-locked', ratings[skill] < threshold);
                    } else if (skills) {
                        // Achievement based on multiple skills
                        const hasAllSkills = skills.every(skill => ratings[skill] >= threshold);
                        DOMHelper.toggleClass(id, 'achievement-locked', !hasAllSkills);
                    } else if (category) {
                        // Achievement based on category average
                        const categorySkills = SKILL_CATEGORIES[category];
                        let validSkills = [];

                        if (typeof categorySkills === 'object' && !Array.isArray(categorySkills)) {
                            // Handle subcategories
                            Object.values(categorySkills).forEach(subSkills => {
                                validSkills = validSkills.concat(subSkills.filter(skill => ratings[skill]));
                            });
                        } else {
                            // Handle regular categories
                            validSkills = categorySkills.filter(skill => ratings[skill]);
                        }

                        const categoryAvg = validSkills.length ? Utils.calculateAverage(validSkills.map(skill => ratings[skill])) : 0;
                        DOMHelper.toggleClass(id, 'achievement-locked', categoryAvg < threshold);
                    }
                });

                const hasPerfectSkill = Object.values(ratings).some(rating => Number(rating) === 10);
                DOMHelper.toggleClass('ultimate_master', 'achievement-locked', !hasPerfectSkill);
            }

            static updateStats(ratings) {
                const skillRatings = Object.entries(ratings)
                    .map(([skill, value]) => ({ name: skill, value: Number(value) }))
                    .sort((a, b) => b.value - a.value);

                const highestValue = skillRatings[0]?.value || 0;
                const highestSkills = skillRatings.filter(skill => skill.value === highestValue);
                const lowestValue = skillRatings[skillRatings.length - 1]?.value || 0;
                const lowestSkills = skillRatings.filter(skill => skill.value === lowestValue);

                DOMHelper.setContent('topSkill', 
                    highestSkills.length === 1 ? Utils.formatSkillName(highestSkills[0].name) 
                    : `${highestSkills.length} Skills Tied`);
                DOMHelper.setContent('topSkillRating', `${highestValue}/10`);

                DOMHelper.setContent('focusSkill',
                    lowestSkills.length === 1 ? Utils.formatSkillName(lowestSkills[0].name)
                    : `${lowestSkills.length} Skills Tied`);
                DOMHelper.setContent('focusSkillRating', `${lowestValue}/10`);
            }

            static updateLevel(ratings) {
                const levelData = SkillsAnalyzer.calculateLevel(ratings);
                
                DOMHelper.setContent('playerRating', levelData.progress);
                DOMHelper.setContent('levelTitle', levelData.config.description);
                DOMHelper.setStyle('levelProgress', 'width', `${levelData.progress}%`);
                DOMHelper.setContent('progressPercent', levelData.progress);
                
                DOMHelper.setHTML('levelIcon', `<i class="fas fa-${levelData.config.icon}"></i>`);
            }

            static updateLevelTitle(name) {
                DOMHelper.setContent('levelTitle', `${name} - ${new Date().toLocaleDateString()}`);
            }

            static updateResults(data) {
                let resultsDiv = document.getElementById('resultsSummary');
                if (!resultsDiv) {
                    // If the element doesn't exist, create it within the assessment-results section
                    const assessmentResults = document.querySelector('.assessment-results');
                    resultsDiv = document.createElement('div');
                    resultsDiv.id = 'resultsSummary';
                    assessmentResults.appendChild(resultsDiv);
                }

                const metaHtml = `
                    <div class="assessment-meta">
                        <div>Name: ${Utils.sanitizeInput(data.name)}</div>
                        <div>Date: ${Utils.sanitizeInput(data.date)}</div>
                    </div>
                `;

                const resultsHtml = Object.entries(SKILL_CATEGORIES)
                    .map(([category, skillsOrSubcategories]) => {
                        if (typeof skillsOrSubcategories === 'object' && !Array.isArray(skillsOrSubcategories)) {
                            // Handle subcategories
                            return Object.entries(skillsOrSubcategories)
                                .map(([subCategory, skills]) => {
                                    const subCategorySkills = skills
                                        .filter(skill => data.ratings[skill])
                                        .map(skill => ({
                                            name: Utils.formatSkillName(skill),
                                            rating: data.ratings[skill]
                                        }));

                                    const subCategoryAvg = Utils.calculateAverage(subCategorySkills.map(s => s.rating)).toFixed(1);

                                    const skillsHtml = subCategorySkills
                                        .map(skill => `
                                            <div class="skill-result">
                                                <span>${skill.name}</span>
                                                <span class="rating">${skill.rating}/10</span>
                                            </div>
                                        `).join('');

                                    return `
                                        <div class="results-group sub-category">
                                            <h3>${category} - ${subCategory}</h3>
                                            <div class="average-rating">Average: <span>${subCategoryAvg}/10</span></div>
                                            ${skillsHtml}
                                        </div>
                                    `;
                                }).join('');
                        } else {
                            // Handle regular categories
                            const categorySkills = skillsOrSubcategories
                                .filter(skill => data.ratings[skill])
                                .map(skill => ({
                                    name: Utils.formatSkillName(skill),
                                    rating: data.ratings[skill]
                                }));

                            const categoryAvg = Utils.calculateAverage(categorySkills.map(s => s.rating)).toFixed(1);

                            const skillsHtml = categorySkills
                                .map(skill => `
                                    <div class="skill-result">
                                        <span>${skill.name}</span>
                                        <span class="rating">${skill.rating}/10</span>
                                    </div>
                                `).join('');

                            return categorySkills.length > 0 ? `
                                <div class="results-group">
                                    <h3>${category}</h3>
                                    <div class="average-rating">Average: <span>${categoryAvg}/10</span></div>
                                    ${skillsHtml}
                                </div>
                            ` : '';
                        }
                    })
                    .join('');

                DOMHelper.setHTML('resultsSummary', metaHtml + resultsHtml);
            }
        }


        class PDFManager {
            static async populatePDFTemplate(data) {
                try {
                    const elements = ['pdfName', 'pdfDate', 'pdfAssessmentDate', 'pdfSkillSections', 'pdfSummaryPoints']
                        .map(id => ({ id, element: document.getElementById(id) }));

                    if (elements.some(({ element }) => !element)) {
                        throw new AppError('Missing PDF template elements', 'pdf-generation');
                    }

                    elements.forEach(({ id, element }) => {
                        if (id.includes('Date')) {
                            element.innerText = data.date;
                        } else if (id === 'pdfName') {
                            element.innerText = data.name;
                        }
                    });

                    DOMHelper.setHTML('pdfSkillSections', this.generateSkillSections(data.ratings));
                    DOMHelper.setHTML('pdfSummaryPoints', this.generateSummaryPoints(data.ratings));

                } catch (error) {
                    throw new AppError('Error populating PDF template', 'pdf-generation');
                }
            }

            static generateSkillSections(ratings) {
                return Object.entries(SKILL_CATEGORIES)
                    .map(([category, skillsOrSubcategories]) => {
                        if (typeof skillsOrSubcategories === 'object' && !Array.isArray(skillsOrSubcategories)) {
                            // Handle subcategories
                            return Object.entries(skillsOrSubcategories)
                                .map(([subCategory, skills]) => {
                                    const subCategoryRatings = skills.map(skill => Number(ratings[skill])).filter(r => !isNaN(r));
                                    const subCategoryAvg = Utils.calculateAverage(subCategoryRatings).toFixed(1);

                                    const skillsList = skills
                                        .filter(skill => ratings[skill])
                                        .map(skill => `
                                            <div class="pdf-skill-item">
                                                <span class="pdf-skill-name">${Utils.formatSkillName(skill)}</span>
                                                <div style="display: flex; align-items: center;">
                                                    <span class="pdf-rating-value">${ratings[skill]}/10</span>
                                                    <div class="pdf-rating-bar">
                                                        <div class="pdf-rating-fill" style="width: ${ratings[skill] * 10}%"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('');

                                    return `
                                        <div class="pdf-section">
                                            <h2>${category} - ${subCategory}</h2>
                                            <div class="pdf-average-rating">Average: ${subCategoryAvg}/10</div>
                                            <div class="pdf-skill-grid">
                                                ${skillsList}
                                            </div>
                                        </div>
                                    `;
                                }).join('');
                        } else {
                            // Handle regular categories
                            const skills = skillsOrSubcategories;
                            const skillsList = skills
                                .filter(skill => ratings[skill])
                                .map(skill => `
                                    <div class="pdf-skill-item">
                                        <span class="pdf-skill-name">${Utils.formatSkillName(skill)}</span>
                                        <div style="display: flex; align-items: center;">
                                            <span class="pdf-rating-value">${ratings[skill]}/10</span>
                                            <div class="pdf-rating-bar">
                                                <div class="pdf-rating-fill" style="width: ${ratings[skill] * 10}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                `).join('');

                            const categoryAvg = Utils.calculateAverage(skills.map(skill => Number(ratings[skill])).filter(r => !isNaN(r))).toFixed(1);

                            return `
                                <div class="pdf-section">
                                    <h2>${category}</h2>
                                    <div class="pdf-average-rating">Average: ${categoryAvg}/10</div>
                                    <div class="pdf-skill-grid">
                                        ${skillsList}
                                    </div>
                                </div>
                            `;
                        }
                    })
                    .join('');
            }

            static generateSummaryPoints(ratings) {
                const summary = SkillsAnalyzer.calculateSkillSummary(ratings);
                const points = [
                    `Strongest Category: ${summary.strongestCategory} (Avg: ${summary.strongestScore.toFixed(1)})`,
                    `Areas for Development: ${summary.weakestCategory} (Avg: ${summary.weakestScore.toFixed(1)})`,
                    summary.topSkills.length > 0 ? 
                        `Top Skills: ${summary.topSkills.map(s => Utils.formatSkillName(s.name)).join(', ')}` : null,
                    summary.improvementAreas.length > 0 ? 
                        `Focus Areas: ${summary.improvementAreas.map(s => Utils.formatSkillName(s.name)).join(', ')}` : null
                ].filter(Boolean);

                return points.map(point => `<li>${point}</li>`).join('');
            }
        }


        class ChartManager {
            static detailedSkills = {};  // Stores skills data per category and subcategory

            /**
             * Initializes the radar chart with the provided assessment data.
             * @param {Object} data - The assessment data containing skill ratings.
             */
            static initializeRadarChart(data) {
                try {
                    const ctx = DOMHelper.getElement('radarChart').getContext('2d');
                    const chartData = this.prepareChartData(data);
                    
                    new Chart(ctx, {
                        type: 'radar',
                        data: chartData,
                        options: this.getChartOptions()
                    });
                } catch (error) {
                    ErrorHandler.handleError(error, 'chart-creation');
                }
            }

            /**
             * Prepares the data for the radar chart by calculating averages.
             * Aggregates "Throwing" subcategories into a single average.
             * @param {Object} data - The assessment data containing skill ratings.
             * @returns {Object} - The data structure required by Chart.js.
             */
            static prepareChartData(data) {
                let labels = [];
                let dataPoints = [];
                this.detailedSkills = {};  // Reset before populating

                Object.entries(SKILL_CATEGORIES).forEach(([category, skillsOrSubcategories]) => {
                    if (typeof skillsOrSubcategories === 'object' && !Array.isArray(skillsOrSubcategories)) {
                        // Handle categories with subcategories
                        if (category === 'Throwing Skills') {
                            // Aggregate "Throwing" subcategories into a single average
                            const throwingSkills = skillsOrSubcategories;
                            const allThrowingSkills = Object.values(throwingSkills).flat();
                            const validSkills = allThrowingSkills.filter(skill => data.ratings[skill]);
                            const average = validSkills.length > 0
                                ? Utils.calculateAverage(validSkills.map(skill => data.ratings[skill]))
                                : 0;

                            labels.push('Throwing');  // Label for the radar chart
                            dataPoints.push(average.toFixed(1));

                            // Store detailed subcategories for tooltip
                            this.detailedSkills['Throwing'] = Object.entries(throwingSkills).map(([subCategory, skills]) => ({
                                name: subCategory,
                                average: Utils.calculateAverage(skills.map(skill => data.ratings[skill])).toFixed(1),
                                skills: skills.filter(skill => data.ratings[skill]).map(skill => ({
                                    name: Utils.formatSkillName(skill),
                                    rating: data.ratings[skill]
                                }))
                            }));
                        }
                        // If there are other categories with subcategories, handle them here
                        // Example:
                        // else if (category === 'Another Category') { ... }
                    } else {
                        // Handle regular categories without subcategories
                        const skills = skillsOrSubcategories;
                        const validSkills = skills.filter(skill => data.ratings[skill]);
                        const average = validSkills.length > 0
                            ? Utils.calculateAverage(validSkills.map(skill => data.ratings[skill]))
                            : 0;

                        labels.push(category);
                        dataPoints.push(average.toFixed(1));

                        // Store detailed skills for tooltip
                        this.detailedSkills[category] = validSkills.map(skill => ({
                            name: Utils.formatSkillName(skill),
                            value: data.ratings[skill]
                        }));
                    }
                });

                return {
                    labels,
                    datasets: [{
                        label: 'Skill Ratings',
                        data: dataPoints,
                        backgroundColor: 'rgba(122, 31, 191, 0.2)',
                        borderColor: 'rgba(255, 145, 35, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(255, 145, 35, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(255, 145, 35, 1)'
                    }]
                };
            }

            /**
             * Configures the radar chart options.
             * @returns {Object} - The configuration options for Chart.js.
             */
            static getChartOptions() {
                return {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: { display: false },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            angleLines: { color: 'rgba(255, 255, 255, 0.2)' },
                            pointLabels: {
                                color: '#e5e5e5',
                                font: { size: 14 }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false,  // Disable the default tooltip
                            external: function(context) {
                                ChartManager.handleChartTooltip(context);
                            }
                        }
                    },
                    animation: {
                        animateRotate: true,
                        animateScale: true,
                        duration: 1200,
                        easing: 'easeOutBounce'
                    }
                };
            }

            /**
             * Handles the creation and display of custom tooltips.
             * Shows subcategories for "Throwing" and individual skills for other categories.
             * @param {Object} context - The context provided by Chart.js tooltip.
             */
            static handleChartTooltip(context) {
                const { chart, tooltip } = context;
                let tooltipEl = document.getElementById('chartjs-tooltip');

                // Create the tooltip element if it doesn't exist
                if (!tooltipEl) {
                    tooltipEl = document.createElement('div');
                    tooltipEl.id = 'chartjs-tooltip';
                    document.body.appendChild(tooltipEl);
                }

                // Hide the tooltip if it's not visible
                if (tooltip.opacity === 0) {
                    tooltipEl.style.opacity = 0;
                    return;
                }

                // Set the tooltip's HTML content
                tooltipEl.innerHTML = `
                    <div class="tooltip-content">
                        <div class="tooltip-header"></div>
                        <div class="tooltip-body"></div>
                    </div>
                `;

                // Apply styling to the tooltip
                Object.assign(tooltipEl.style, {
                    opacity: 1,
                    position: 'absolute',
                    background: 'rgba(45, 45, 45, 0.95)',
                    color: '#fff',
                    borderRadius: '8px',
                    padding: '12px',
                    pointerEvents: 'none',
                    boxShadow: '0 4px 12px rgba(0,0,0,0.3)',
                    transition: 'all .1s ease',
                    fontSize: '14px',
                    border: '1px solid rgba(255,255,255,0.1)',
                    minWidth: '200px',
                    maxWidth: '280px'
                });

                // Position the tooltip near the cursor
                const position = chart.canvas.getBoundingClientRect();
                tooltipEl.style.left = position.left + window.pageXOffset + tooltip.caretX + 'px';
                tooltipEl.style.top = position.top + window.pageYOffset + tooltip.caretY + 'px';

                // Populate the tooltip content based on the hovered label
                if (tooltip.body) {
                    const index = tooltip.dataPoints[0].dataIndex;
                    const label = chart.data.labels[index];
                    const average = chart.data.datasets[0].data[index];
                    const skills = this.detailedSkills[label] || [];

                    const headerContent = tooltipEl.querySelector('.tooltip-header');
                    const bodyContent = tooltipEl.querySelector('.tooltip-body');

                    // Set header information
                    headerContent.style.borderBottom = '1px solid rgba(255,255,255,0.1)';
                    headerContent.style.marginBottom = '8px';
                    headerContent.style.paddingBottom = '8px';
                    headerContent.innerHTML = `
                        <div style="font-weight: 600; font-size: 16px; color: #ff9123; margin-bottom: 4px;">
                            ${label}
                        </div>
                        <div style="font-size: 14px; color: rgba(255,255,255,0.9);">
                            Average: ${average}/10
                        </div>
                    `;

                    if (label === 'Throwing') {
                        // Display subcategories with their averages and individual skills
                        bodyContent.innerHTML = skills.map(subCat => `
                            <div style="margin-bottom: 10px;">
                                <strong>${subCat.name}:</strong> Average ${subCat.average}/10
                                <div style="padding-left: 10px;">
                                    ${subCat.skills.map(skill => `
                                        <div style="
                                            display: flex;
                                            justify-content: space-between;
                                            align-items: center;
                                            padding: 2px 0;
                                        ">
                                            <span style="color: rgba(255,255,255,0.9);">${skill.name}</span>
                                            <span style="
                                                background: rgba(255,145,35,0.2);
                                                padding: 2px 8px;
                                                border-radius: 4px;
                                                color: #ff9123;
                                                font-weight: 600;
                                            ">${skill.rating}/10</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('');
                    } else {
                        // Display individual skills for other categories
                        bodyContent.innerHTML = skills.map(skill => `
                            <div style="
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                                padding: 4px 0;
                                border-bottom: 1px solid rgba(255,255,255,0.05);
                            ">
                                <span style="color: rgba(255,255,255,0.9);">${skill.name}</span>
                                <span style="
                                    background: rgba(255,145,35,0.2);
                                    padding: 2px 8px;
                                    border-radius: 4px;
                                    color: #ff9123;
                                    font-weight: 600;
                                ">${skill.value}/10</span>
                            </div>
                        `).join('');
                    }

                    // Add scroll if the content is too long
                    if (skills.length > 5 || (label === 'Throwing' && this.detailedSkills[label].some(subCat => subCat.skills.length > 5))) {
                        Object.assign(bodyContent.style, {
                            maxHeight: '200px',
                            overflowY: 'auto',
                            marginRight: '-6px',  // Compensate for scrollbar
                            paddingRight: '6px'
                        });
                    }
                }
            }
        }


        // Initialize application
        window.addEventListener('load', () => {
            UIManager.init();
            if (window.location.hostname.includes('netlify.app')) {
                const meta = document.createElement('meta');
                meta.httpEquiv = 'Content-Security-Policy';
                meta.content = "default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://*.netlify.app https://cdnjs.cloudflare.com";
                document.head.appendChild(meta);
            }
        });

        window.addEventListener('error', (e) => {
            if (e.message.includes('html2pdf') || e.message.includes('jsPDF')) {
                ErrorHandler.handleError(new Error(e.message), 'pdf-generation');
            }
        }, true);

        document.getElementById('saveButton').addEventListener('click', () => {
            PDFManager.generatePDF(AssessmentDataManager.getAssessmentData());
        });

        // Export for testing
        if (typeof module !== 'undefined') {
            module.exports = {
                Utils,
                AssessmentDataManager,
                SkillsAnalyzer,
                UIManager,
                PDFManager,
                ChartManager,
                ErrorHandler
            };
        }
    </script>
</body>
</html>